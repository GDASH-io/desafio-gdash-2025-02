# ğŸš€ Quick Start Guide - GDASH Weather App

Este guia fornece instruÃ§Ãµes rÃ¡pidas para executar a aplicaÃ§Ã£o completa de monitoramento climÃ¡tico com integraÃ§Ã£o de IA.

## ğŸ“‹ PrÃ©-requisitos

- **Docker** e **Docker Compose** instalados
- **Git** para clonar o repositÃ³rio

---

## ğŸ³ Como rodar tudo via Docker Compose

A maneira mais simples de executar toda a aplicaÃ§Ã£o Ã© usando Docker Compose, que orquestra todos os serviÃ§os automaticamente.

### 1. Configure as variÃ¡veis de ambiente (opcional)

Edite o arquivo `docker-compose.yml` para configurar:

**API Keys de IA (para geraÃ§Ã£o de insights):**
```yaml
# No serviÃ§o 'api'
environment:
  OPENAI_API_KEY: your_openai_api_key_here
  FALLBACK_GEMINI_API_KEY: your_gemini_api_key_here
  JWT_SECRET: sua_chave_jwt_aqui
```

**LocalizaÃ§Ã£o e intervalo de coleta de dados climÃ¡ticos:**
```yaml
# No serviÃ§o 'producer'
environment:
  LONG: -46.53632098751176  # Longitude da sua cidade
  LAT: -22.970198162589284  # Latitude da sua cidade
  INTERVAL_SECONDS: 60      # Intervalo de coleta em segundos (padrÃ£o: 60s = 1 minuto)
  TIMEZONE: America/Sao_Paulo # ConfiguraÃ§Ã£o do Timezone que serÃ¡ utilizado pela API
```

> ğŸ“Š **Pipeline de Dados**: Por padrÃ£o, a pipeline estÃ¡ configurada para coletar dados climÃ¡ticos a cada **1 minuto** (`INTERVAL_SECONDS: 60`). VocÃª pode modificar esse intervalo alterando a variÃ¡vel `INTERVAL_SECONDS` no `docker-compose.yml` de acordo com suas necessidades (ex: 120 para 2 minutos, 300 para 5 minutos, etc.).

### 2. Configure os volumes do MongoDB (opcional, mas recomendado)

Para iniciar o aplicativo com dados prÃ©-configurados (usuÃ¡rio ADMIN e dados climÃ¡ticos), siga os passos abaixo:

1. **Acesse a pasta ROOT** do projeto
2. **Baixe os volumes do MongoDB** neste link: [Download MongoDB Volumes](https://drive.google.com/drive/folders/1c1OtP8h-B-q4Gf6i4jDWzW845AgE6Rp2?usp=sharing)
3. **ApÃ³s baixar**, cole a pasta do volume na raiz do projeto
       - FicarÃ¡ assim a estrutura de pastas:
              - api
              - consumer
              - fe
              - producer
              - temp_data
4. Com o volume do MongoDB configurado, vocÃª pode iniciar o aplicativo normalmente

**âš ï¸ ObservaÃ§Ã£o importante:**

O download dos volumes do MongoDB **NÃƒO Ã‰ OBRIGATÃ“RIO**. VocÃª pode iniciar o projeto sem eles, mas:
- O app iniciarÃ¡ sem nenhum dado no banco de dados
- VocÃª precisarÃ¡ aguardar a pipeline de dados popular o DB automaticamente
- LevarÃ¡ algum tempo atÃ© que dados climÃ¡ticos sejam coletados e exibidos

### 3. Inicie todos os serviÃ§os

```bash
docker-compose up --build -d
```

Este comando irÃ¡:
- âœ… Criar e iniciar o **MongoDB**
- âœ… Criar e iniciar o **RabbitMQ**
- âœ… Criar e iniciar o **Producer** (Python)
- âœ… Criar e iniciar a **API** (NestJS)
- âœ… Criar e iniciar o **Consumer** (Go)
- âœ… Criar e iniciar o **Frontend** (React + Vite)

### 4. Acompanhe os logs

```bash
# Ver logs de todos os serviÃ§os
docker-compose logs -f

# Ver logs de um serviÃ§o especÃ­fico
docker-compose logs -f api
docker-compose logs -f producer
docker-compose logs -f consumer
docker-compose logs -f frontend
```

### 5. Parar todos os serviÃ§os

```bash
# Parar sem remover containers
docker-compose stop

# Parar e remover containers
docker-compose down

# Parar, remover containers e volumes (limpa dados do banco)
docker-compose down -v
```

---

## ğŸ Como rodar o serviÃ§o Python (Producer)

O **Producer** Ã© responsÃ¡vel por coletar dados climÃ¡ticos da API Open-Meteo e enviar para o RabbitMQ.

### Executando via Docker (recomendado)

```bash
cd producer
docker build -t weather-producer .
docker run --rm \
  -e INTERVAL_SECONDS=60 \
  -e RABBITMQ_HOST=rabbitmq \
  -e RABBITMQ_PORT=5672 \
  -e RABBITMQ_USER=admin \
  -e RABBITMQ_PASS=admin123 \
  -e QUEUE_NAME=weather_data \
  -e LONG=-46.53632098751176 \
  -e LAT=-22.970198162589284 \
  --network desafio-gdash-2025-02_app-network \
  weather-producer
```

Ou

```bash
docker compose up producer -d
```


**VariÃ¡veis de ambiente disponÃ­veis:**
- `INTERVAL_SECONDS`: Intervalo entre coletas (padrÃ£o: 60s)
- `RABBITMQ_HOST`: Host do RabbitMQ
- `RABBITMQ_PORT`: Porta do RabbitMQ (padrÃ£o: 5672)
- `RABBITMQ_USER`: UsuÃ¡rio do RabbitMQ
- `RABBITMQ_PASS`: Senha do RabbitMQ
- `QUEUE_NAME`: Nome da fila (padrÃ£o: weather_data)
- `LONG`: Longitude da localizaÃ§Ã£o
- `LAT`: Latitude da localizaÃ§Ã£o
- `OPENWEATHER_API_URL`: URL da API de clima

---

## ğŸ¹ Como rodar o worker Go (Consumer)

O **Consumer** processa mensagens da fila RabbitMQ e envia os dados para a API NestJS.

### Executando via Docker (recomendado)

```bash
cd consumer
docker build -t weather-consumer .
docker run --rm \
  -e RABBITMQ_URL=amqp://admin:admin123@rabbitmq:5672/ \
  -e NESTJS_API=http://api:3000/weather \
  -e QUEUE_NAME=weather_data \
  --network desafio-gdash-2025-02_app-network \
  weather-consumer
```

Ou

```bash
docker compose up consumer -d
```


**VariÃ¡veis de ambiente disponÃ­veis:**
- `RABBITMQ_URL`: URL de conexÃ£o do RabbitMQ (formato: `amqp://user:pass@host:port/`)
- `NESTJS_API`: URL da API NestJS para enviar dados
- `QUEUE_NAME`: Nome da fila para consumir (padrÃ£o: weather_data)


---

## ğŸŒ URLs principais

ApÃ³s iniciar todos os serviÃ§os com Docker Compose, acesse:

### ğŸ¨ Frontend (React + Vite)
- **URL**: http://localhost:4173
- **DescriÃ§Ã£o**: Dashboard principal com visualizaÃ§Ãµes de dados climÃ¡ticos, insights de IA, gestÃ£o de usuÃ¡rios e integraÃ§Ã£o com API pÃºblica

**Credenciais padrÃ£o:**
- Email: `admin@gmail.com`
- Senha: `admin123`

### ğŸš€ API Backend (NestJS)
- **URL Base**: http://localhost:3000
- **Health Check**: http://localhost:3000/health


### ğŸ° RabbitMQ Management
- **URL**: http://localhost:15672
- **UsuÃ¡rio**: `admin`
- **Senha**: `admin123`
- **DescriÃ§Ã£o**: Interface de gerenciamento do RabbitMQ para monitorar filas, conexÃµes e mensagens

### ğŸƒ MongoDB
- **Host**: localhost
- **Porta**: 27017
- **UsuÃ¡rio**: `admin`
- **Senha**: `admin123`
- **Database**: `gdash`
- **Connection String**: `mongodb://admin:admin123@localhost:27017/gdash?authSource=admin`

---

## ğŸ—ï¸ Arquitetura da aplicaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend   â”‚ (React + Vite + Tailwind)
â”‚  :4173      â”‚ http://localhost:4173
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API NestJS â”‚ (Backend + MongoDB)
â”‚  :3000      â”‚ http://localhost:3000
â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ HTTP POST /weather
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚  Consumer   â”‚ (Go Worker)
â”‚   (Go)      â”‚
â””â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Consume messages
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  RabbitMQ   â”‚ (Message Broker)
â”‚  :5672      â”‚ amqp://localhost:5672
â”‚  :15672     â”‚ http://localhost:15672 (UI)
â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Publish messages
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚  Producer   â”‚ (Python)
â”‚  (Python)   â”‚ Coleta dados da API Open-Meteo
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Open-Meteo  â”‚ (API Externa)
â”‚  API        â”‚ https://open-meteo.com
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Fluxo de dados:**
1. ğŸ **Producer** (Python) coleta dados climÃ¡ticos da API Open-Meteo a cada 60 segundos
2. ğŸ“¨ Publica mensagem na fila `weather_data` do **RabbitMQ**
3. ğŸ¹ **Consumer** (Go) consome mensagem da fila
4. ğŸ“¤ Envia dados via HTTP POST para a **API NestJS**
5. ğŸ’¾ **API** armazena no **MongoDB** e processa com IA (OpenAI/Gemini)
6. ğŸ¨ **Frontend** consulta API e exibe dashboard com grÃ¡ficos e insights

---

## ğŸ§ª Executando testes

### Testes da API (NestJS)

```bash
cd api

# Instalar dependÃªncias
npm install

# Executar todos os testes
npm test
```

---

## ğŸ”’ SeguranÃ§a da API

A API implementa mÃºltiplas camadas de seguranÃ§a para proteger os dados e garantir comunicaÃ§Ã£o segura:

### Headers de SeguranÃ§a (Helmet)
A API utiliza o **Helmet** para configurar automaticamente headers de seguranÃ§a HTTP que protegem contra vulnerabilidades comuns:
- **X-Content-Type-Options**: Previne MIME-sniffing attacks
- **X-Frame-Options**: Protege contra clickjacking
- **Strict-Transport-Security**: ForÃ§a comunicaÃ§Ã£o HTTPS
- **X-XSS-Protection**: ProteÃ§Ã£o adicional contra ataques XSS
- **Content-Security-Policy**: Controla recursos que podem ser carregados

### AutenticaÃ§Ã£o JWT
- Tokens **JWT (JSON Web Tokens)** para autenticaÃ§Ã£o stateless
- Tokens assinados com chave secreta configurÃ¡vel via `JWT_SECRET`
- ExpiraÃ§Ã£o configurÃ¡vel para renovaÃ§Ã£o periÃ³dica
- Guards personalizados protegem rotas sensÃ­veis

### CORS Configurado
- CORS habilitado com controle de origens permitidas
- Headers de seguranÃ§a incluÃ­dos na lista de headers permitidos
- Controle de mÃ©todos HTTP permitidos (GET, POST, PUT, DELETE, PATCH)
- Credentials habilitados para autenticaÃ§Ã£o cross-origin

### ValidaÃ§Ã£o de Entrada
- **ValidationPipe** global para validaÃ§Ã£o automÃ¡tica de DTOs
- ValidaÃ§Ãµes com `class-validator` em todos os endpoints
- SanitizaÃ§Ã£o automÃ¡tica de dados de entrada
- TransformaÃ§Ã£o de tipos para garantir integridade

### Tratamento de Erros
- Filtros de exceÃ§Ã£o personalizados
- Mensagens de erro sanitizadas (nÃ£o expÃµem detalhes internos)
- Logging estruturado de erros para auditoria

### Rate Limiting
- Rate limiting pode ser adicionado via `@nestjs/throttler`
- Evita ataques de forÃ§a bruta na API.
- Configurando alguns endpoints para aceitar menos requisiÃ§Ãµes por minuto.

---

## ğŸ“š Tecnologias utilizadas

**Backend:**
- NestJS
- MongoDB 8
- Mongoose
- JWT Authentication
- OpenAI SDK
- Gemini AI SDK
- Go
- Python

**Frontend:**
- React 19
- Vite
- TypeScript
- Tailwind CSS
- shadcn/ui
- Recharts
- Axios

**Infraestrutura:**
- Docker & Docker Compose
- RabbitMQ
- MongoDB 8

**Message Broker:**
- RabbitMQ (AMQP)

**APIs Externas:**
- Open-Meteo API (dados climÃ¡ticos)
- OpenAI API (insights de IA)
- Google Gemini API (insights de IA - fallback)

---

## ğŸ“ Notas importantes

1. **Primeira execuÃ§Ã£o**: O primeiro build pode demorar alguns minutos
2. **API Keys**: Configure as chaves da OpenAI/Gemini para habilitar insights de IA
3. **Dados persistentes**: Os dados do MongoDB ficam em `./temp_data/mongo/` e podem ser baixados via GOOGLE DRIVE , nesse link
4. **Logs do RabbitMQ**: Configurado para mostrar apenas erros
5. **Healthchecks**: Todos os serviÃ§os tÃªm healthcheck configurado
6. **Multi-stage build**: Docker usa multi-stage para otimizar tamanho das imagens

---

**Desenvolvido para o desafio GDASH 2025/02** ğŸš€
